# Load-Balanced HAProxy Infrastructure

> **–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –≤—ã—Å–æ–∫–æ–¥–æ—Å—Ç—É–ø–Ω–∞—è –ø—Ä–æ–∫—Å–∏-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏, –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º failover.**

[![Infrastructure](https://img.shields.io/badge/Infrastructure-Production-green.svg)]
[![HAProxy](https://img.shields.io/badge/HAProxy-2.8+-blue.svg)](https://www.haproxy.org/)
[![WireGuard](https://img.shields.io/badge/WireGuard-Latest-orange.svg)](https://www.wireguard.com/)
[![Monitoring](https://img.shields.io/badge/Monitoring-Prometheus-red.svg)](https://prometheus.io/)

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## üåê –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç production-grade –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é –ø—Ä–æ–∫—Å–∏-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º HAProxy –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ endpoint'–∞–º–∏.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- **–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å**: Endpoint'—ã –≤ –ù–æ—Ä–≤–µ–≥–∏–∏ (–û—Å–ª–æ), –ù–∏–¥–µ—Ä–ª–∞–Ω–¥–∞—Ö (–ê–º—Å—Ç–µ—Ä–¥–∞–º) –∏ –ì–µ—Ä–º–∞–Ω–∏–∏
- **–£–º–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞**: –ê–ª–≥–æ—Ä–∏—Ç–º leastconn —Å –ª–∏–ø–∫–∏–º–∏ —Å–µ—Å—Å–∏—è–º–∏ (sticky sessions)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π failover**: –°–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∞—è—Å—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ endpoint'–∞–º–∏
- **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°—Ç–µ–∫ Prometheus + Grafana + Alertmanager
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è NTOP –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–∞–∫–µ—Ç–æ–≤ (DPI)
- **–ó–∞—â–∏—â—ë–Ω–Ω–æ–µ —Ç—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: WireGuard VPN mesh –º–µ–∂–¥—É –≤—Å–µ–º–∏ —É–∑–ª–∞–º–∏
- **ChatOps**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram –±–æ—Ç–æ–º –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                    ‚îÇ   Telegram Bot  ‚îÇ
                                    ‚îÇ   –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è   ‚îÇ
                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                             ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                        ‚îÇ                        ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ  Oslo Endpoint ‚îÇ      ‚îÇ Germany Load   ‚îÇ      ‚îÇ Amsterdam      ‚îÇ
            ‚îÇ  (–ù–æ—Ä–≤–µ–≥–∏—è)    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   Balancer     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   Endpoint     ‚îÇ
            ‚îÇ                ‚îÇ      ‚îÇ  (HAProxy)     ‚îÇ      ‚îÇ  (–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã)  ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ                       ‚îÇ                        ‚îÇ
                     ‚îÇ         WireGuard Mesh Network                 ‚îÇ
                     ‚îÇ              (10.0.0.0/24)                     ‚îÇ
                     ‚îÇ                       ‚îÇ                        ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                             ‚îÇ
                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                    ‚îÇ  SPB Monitoring ‚îÇ
                                    ‚îÇ  Prometheus +   ‚îÇ
                                    ‚îÇ  Grafana +      ‚îÇ
                                    ‚îÇ  Alertmanager   ‚îÇ
                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫ —Ç—Ä–∞—Ñ–∏–∫–∞

```
–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚Üì
HAProxy Load Balancer (–ì–µ—Ä–º–∞–Ω–∏—è)
    ‚Üì (leastconn + sticky sessions)
    ‚îú‚îÄ‚Üí Oslo Endpoint (–≤–µ—Å: 255) ‚îÄ‚îÄ‚Üí WireGuard ‚îÄ‚îÄ‚Üí –ò–Ω—Ç–µ—Ä–Ω–µ—Ç
    ‚îú‚îÄ‚Üí Amsterdam Endpoint (–≤–µ—Å: 245) ‚îÄ‚îÄ‚Üí WireGuard ‚îÄ‚îÄ‚Üí –ò–Ω—Ç–µ—Ä–Ω–µ—Ç
    ‚îî‚îÄ‚Üí Local Backup (–≤–µ—Å: 1) ‚îÄ‚îÄ‚Üí –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (failover)
```

–ü–æ–¥—Ä–æ–±–Ω—ã–µ —Å—Ö–µ–º—ã –≤ [`docs/diagrams/`](docs/diagrams/)

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫**: HAProxy 2.8+ (leastconn, sticky sessions)
- **VPN**: WireGuard (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—É–Ω–Ω–µ–ª–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏)
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker + Docker Compose
- **–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è**: KVM, Proxmox VE

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
- **–ú–µ—Ç—Ä–∏–∫–∏**: Prometheus
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: Grafana
- **–ê–ª–µ—Ä—Ç–∏–Ω–≥**: Alertmanager
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞**: NTOP (ntopng)
- **–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã**: 
  - Node Exporter (—Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏)
  - cAdvisor (–º–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
  - HAProxy Exporter (–º–µ—Ç—Ä–∏–∫–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞)
  - –ö–∞—Å—Ç–æ–º–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç—É–Ω–Ω–µ–ª–µ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **Infrastructure as Code**: Ansible (87 playbooks –≤ [cosmic-ops](https://github.com/alienuniversed/cosmic-ops))
- **ChatOps**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Ansible
- **–°–∫—Ä–∏–ø—Ç—ã**: Bash –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏

> üìå **–í–∞–∂–Ω–æ**: –≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –î–ª—è **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç [**cosmic-ops**](https://github.com/alienuniversed/cosmic-ops) —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º Ansible playbooks (87 —à—Ç—É–∫) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
- ‚úÖ **–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ endpoint'—ã** –≤ 3 —Å—Ç—Ä–∞–Ω–∞—Ö (–ù–æ—Ä–≤–µ–≥–∏—è, –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã, –ì–µ—Ä–º–∞–Ω–∏—è)
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π failover** –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π endpoint –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö
- ‚úÖ **Health checks** –¥–ª—è –≤—Å–µ—Ö backend —É–∑–ª–æ–≤ (TCP –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ **–°–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∞—è—Å—è** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º backup

### –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ **–ê–ª–≥–æ—Ä–∏—Ç–º leastconn** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ **Sticky sessions** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—è–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ —Å–µ—Ä–≤–µ—Ä—É –Ω–∞ 30 –º–∏–Ω—É—Ç
- ‚úÖ **–í–∑–≤–µ—à–µ–Ω–Ω—ã–µ backend'—ã** - Oslo (255), Amsterdam (245), Local backup (1)
- ‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ rate** - –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS –∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ **WireGuard VPN mesh** - –≤–µ—Å—å –º–µ–∂—É–∑–ª–æ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω
- ‚úÖ **–ü—Ä–∏–≤–∞—Ç–Ω–∞—è —Å–µ—Ç—å** - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è 10.0.0.0/24
- ‚úÖ **NTOP –∞–Ω–∞–ª–∏–∑** - –≥–ª—É–±–æ–∫–∞—è –∏–Ω—Å–ø–µ–∫—Ü–∏—è –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ –≤—Å–µ—Ö endpoint'–∞—Ö
- ‚úÖ **–ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤** - –ø—É–±–ª–∏—á–µ–Ω —Ç–æ–ª—å–∫–æ frontend HAProxy

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ **–ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏** - Prometheus + Grafana + Alertmanager
- ‚úÖ **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏** - —Å–∏—Å—Ç–µ–º–∞, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å–µ—Ç—å
- ‚úÖ **–ê–ª–µ—Ä—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- ‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è NTOP –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
- ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—É–Ω–Ω–µ–ª–µ–π** - –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ WireGuard

---

## üè¢ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### 1. Germany Load Balancer (–ì–µ—Ä–º–∞–Ω–∏—è - –§—Ä–∞–Ω–∫—Ñ—É—Ä—Ç)
**–†–æ–ª—å**: –û—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å —Ç—Ä–∞—Ñ–∏–∫–∞

**–°–µ—Ä–≤–∏—Å—ã**:
- HAProxy (–ø–æ—Ä—Ç—ã 443, 447, 448)
- Node Exporter (–ø–æ—Ä—Ç 8443)
- cAdvisor (–ø–æ—Ä—Ç 8446)
- WireGuard (wg0, wg3)

**–ö–æ–Ω—Ñ–∏–≥–∏**: [`germany-loadbalancer/`](germany-loadbalancer/)

### 2. Oslo Endpoint (–ù–æ—Ä–≤–µ–≥–∏—è - –û—Å–ª–æ)
**–†–æ–ª—å**: VLESS endpoint —Å –∞–Ω–∞–ª–∏–∑–æ–º —Ç—Ä–∞—Ñ–∏–∫–∞

**–°–µ—Ä–≤–∏—Å—ã**:
- VLESS —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 449)
- NTOP analyzer
- Node Exporter (–ø–æ—Ä—Ç 8443)
- WireGuard (wg0)

**–ö–æ–Ω—Ñ–∏–≥–∏**: [`norway-oslo/`](norway-oslo/)

### 3. Amsterdam Endpoint (–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã - –ê–º—Å—Ç–µ—Ä–¥–∞–º)
**–†–æ–ª—å**: VLESS endpoint —Å –∞–Ω–∞–ª–∏–∑–æ–º —Ç—Ä–∞—Ñ–∏–∫–∞

**–°–µ—Ä–≤–∏—Å—ã**:
- VLESS —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 449)
- NTOP analyzer
- Node Exporter (–ø–æ—Ä—Ç 8443)
- WireGuard (wg0)

**–ö–æ–Ω—Ñ–∏–≥–∏**: [`netherlands-amsterdam/`](netherlands-amsterdam/)

### 4. SPB Monitoring Server (–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥)
**–†–æ–ª—å**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥

**–°–µ—Ä–≤–∏—Å—ã**:
- Prometheus (–ø–æ—Ä—Ç 9090)
- Grafana (–ø–æ—Ä—Ç 3000)
- Alertmanager (–ø–æ—Ä—Ç 9093)
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–±–æ—Ä—â–∏–∫–∏ –º–µ—Ç—Ä–∏–∫

**–ö–æ–Ω—Ñ–∏–≥–∏**: [`spb-monitoring/`](spb-monitoring/)

### 5. SPB AI Video Server (–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥)
**–†–æ–ª—å**: AI-–∞–Ω–∞–ª–∏–∑ –≤–∏–¥–µ–æ —Å CCTV –∫–∞–º–µ—Ä (–æ—Ç–¥–µ–ª—å–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

**–°–µ—Ä–≤–∏—Å—ã**:
- AI –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ
- cAdvisor (–ø–æ—Ä—Ç 8080)
- Node Exporter (–ø–æ—Ä—Ç 9100)

**–ö–æ–Ω—Ñ–∏–≥–∏**: [`spb-ai-videoserver/`](spb-ai-videoserver/)

---

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ñ–µ–ª–µ–∑–æ
- **Load Balancer**: 2 CPU, 2GB RAM, 20GB –¥–∏—Å–∫
- **Endpoints**: 2 CPU, 2GB RAM, 20GB –¥–∏—Å–∫ –Ω–∞ –∫–∞–∂–¥—ã–π
- **Monitoring Server**: 4 CPU, 8GB RAM, 100GB –¥–∏—Å–∫

### –°–æ—Ñ—Ç
- Ubuntu 22.04 LTS –∏–ª–∏ –Ω–æ–≤–µ–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- Docker 24.0+
- Docker Compose 2.0+
- WireGuard kernel module
- HAProxy 2.8+
- Python 3.10+ (–¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏)

### –°–µ—Ç—å
- –ü—É–±–ª–∏—á–Ω—ã–µ IPv4 –∞–¥—Ä–µ—Å–∞ –¥–ª—è –≤—Å–µ—Ö endpoint'–æ–≤
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã:
  - 443/TCP (HAProxy frontend)
  - 51820/UDP, 51823/UDP (WireGuard)
  - 8443/TCP (Node Exporter, —á–µ—Ä–µ–∑ VPN)
  - 9100/TCP (–º–µ—Ç—Ä–∏–∫–∏ Prometheus, —á–µ—Ä–µ–∑ VPN)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/yourusername/load-balanced-haproxy-infrastructure.git
cd load-balanced-haproxy-infrastructure
```

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π WireGuard

```bash
# –ù–∞ –∫–∞–∂–¥–æ–º —É–∑–ª–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ä—É –ø—Ä–∏–≤–∞—Ç–Ω—ã–π/–ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
wg genkey | tee privatekey | wg pubkey > publickey

# –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–µ—Ä–∂–∏–º –≤ —Å–µ–∫—Ä–µ—Ç–µ!
# –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –ø–µ—Ä–µ–¥–∞—ë–º –¥—Ä—É–≥–∏–º —É–∑–ª–∞–º
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Endpoint'–æ–≤

```bash
# –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å –≤–∞—à–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
cp germany-loadbalancer/configs/haproxy.cfg.example germany-loadbalancer/configs/haproxy.cfg
cp germany-loadbalancer/configs/wg0.conf.example germany-loadbalancer/configs/wg0.conf

# –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã:
# - <REDACTED_PRIVATE_KEY> ‚Üí –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á WireGuard
# - <GERMANY_LB_PUBLIC_IP> ‚Üí –ø—É–±–ª–∏—á–Ω—ã–π IP –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞
# - <AMSTERDAM_PUBLIC_IP> ‚Üí –ø—É–±–ª–∏—á–Ω—ã–π IP Amsterdam endpoint
# - <OSLO_PUBLIC_IP> ‚Üí –ø—É–±–ª–∏—á–Ω—ã–π IP Oslo endpoint
# - <CHANGE_ME_PASSWORD> ‚Üí –ø–∞—Ä–æ–ª—å –¥–ª—è HAProxy stats
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WireGuard —Ç—É–Ω–Ω–µ–ª–µ–π

```bash
# –ù–∞ –∫–∞–∂–¥–æ–º —É–∑–ª–µ:
sudo cp configs/wg0.conf /etc/wireguard/
sudo wg-quick up wg0
sudo systemctl enable wg-quick@wg0

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏
ping 10.0.0.1  # Germany LB
ping 10.0.0.2  # Amsterdam
ping 10.0.0.5  # Oslo
```

### 5. –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ HAProxy

```bash
# –ù–∞ Germany load balancer:
sudo cp germany-loadbalancer/configs/haproxy.cfg /etc/haproxy/
sudo systemctl restart haproxy
sudo systemctl enable haproxy

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status haproxy
```

### 6. –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å—Ç–µ–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –ù–∞ SPB monitoring server:
cd spb-monitoring/configs
docker-compose -f monitoring-docker-compose.yml up -d

# –î–æ—Å—Ç—É–ø –∫ Grafana: http://<monitoring-server>:3000
# –õ–æ–≥–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: admin / admin (—Å–º–µ–Ω–∏—Ç–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ!)
```

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ HAProxy stats
curl http://<germany-lb-ip>:447

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Prometheus targets
curl http://<monitoring-server>:9090/targets

# –¢–µ—Å—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
curl -v https://<germany-lb-ip>:443
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ HAProxy

–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `germany-loadbalancer/configs/haproxy.cfg`:

```haproxy
backend vless_pool
        mode tcp
        balance leastconn
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ—Å–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ—â–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
        server oslo-node 10.0.0.5:449  check weight 255
        server ams-node 10.0.0.2:449 check weight 245
        server local-backup 127.0.0.1:449 check weight 1
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ—Å–æ–≤**:
- –ë–æ–ª—å—à–∏–π –≤–µ—Å = –±–æ–ª—å—à–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `weight 1` = —Ç–æ–ª—å–∫–æ –¥–ª—è backup
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç CPU/–ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–∏–ø–∫–∏—Ö —Å–µ—Å—Å–∏–π

```haproxy
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–≤—è–∑–∫–∏ —Å–µ—Å—Å–∏–∏
stick-table type ip size 200k expire 30m
```

- `30m` = 30 –º–∏–Ω—É—Ç –ø—Ä–∏–≤—è–∑–∫–∏ –∫ endpoint'—É
- –£–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- –£–º–µ–Ω—å—à–∞–π—Ç–µ –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

### –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã Health Check

```haproxy
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
check inter 2000 rise 1 fall 2
```

- `inter 2000` = –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
- `rise 1` = —Å—á–∏—Ç–∞—Ç—å –∑–¥–æ—Ä–æ–≤—ã–º –ø–æ—Å–ª–µ 1 —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- `fall 2` = —Å—á–∏—Ç–∞—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –ø–æ—Å–ª–µ 2 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –î–æ—Å—Ç—É–ø –∫ –¥–∞—à–±–æ—Ä–¥–∞–º

**Grafana**: `http://<monitoring-server>:3000`
- –õ–æ–≥–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `admin` / `admin`
- –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**HAProxy Stats**: `http://<germany-lb-ip>:447`
- –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–¥–æ—Ä–æ–≤—å—è backend'–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Å—Å–∏–π

**Prometheus**: `http://<monitoring-server>:9090`
- –°—ã—Ä—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ PromQL –∑–∞–ø—Ä–æ—Å—ã
- –°—Ç–∞—Ç—É—Å –∑–¥–æ—Ä–æ–≤—å—è —Ü–µ–ª–µ–π (targets)

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

**–°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏** (Node Exporter):
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU, –ø–∞–º—è—Ç–∏, –¥–∏—Å–∫–∞ I/O
- –°–µ—Ç–µ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫ –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∏ uptime

**–ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** (cAdvisor):
- CPU –∏ –ø–∞–º—è—Ç—å –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- –°–µ—Ç–µ–≤–æ–π I/O –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

**–ú–µ—Ç—Ä–∏–∫–∏ HAProxy**:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø–æ backend'–∞–º
- Rate –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ endpoint
- –°—Ç–∞—Ç—É—Å health check'–æ–≤
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ª–∏–ø–∫–∏—Ö —Å–µ—Å—Å–∏–π

**–ú–µ—Ç—Ä–∏–∫–∏ —Ç—É–Ω–Ω–µ–ª–µ–π** (–ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã):
- –°—Ç–∞—Ç—É—Å handshake WireGuard
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Ç—É–Ω–Ω–µ–ª—è
- –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏

### –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

–°–º. `spb-monitoring/configs/alert.rules.yml` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤:

- –í—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ CPU (>80% –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç)
- –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (>90%)
- Endpoint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ü–æ—Ç–µ—Ä—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ç—É–Ω–Ω–µ–ª—è
- –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫

**–ê–ª–µ—Ä—Ç—ã –≤ Telegram**:
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Telegram —á–∞—Ç
- –í–∫–ª—é—á–∞—é—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏**:
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
export HAPROXY_STATS_PASSWORD="your-secure-password"
export TELEGRAM_BOT_TOKEN="your-bot-token"
```

‚úÖ **–ö–ª—é—á–∏ WireGuard**:
```bash
# –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞
wg genkey | tee privatekey | wg pubkey > publickey

# –ó–∞—â–∏—Ç–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏
chmod 600 /etc/wireguard/wg0.conf
chown root:root /etc/wireguard/wg0.conf
```

‚úÖ **–ü—Ä–∞–≤–∏–ª–∞ Firewall**:
```bash
# –û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
ufw allow 443/tcp    # HAProxy frontend
ufw allow 51820/udp  # WireGuard
ufw deny 8443/tcp    # –ë–ª–æ–∫–∏—Ä—É–π—Ç–µ exporters –æ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
```

‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è HAProxy Stats**:
```haproxy
# –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
stats auth admin:<STRONG_PASSWORD>
```

### –ß–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- [ ] –ò–∑–º–µ–Ω–µ–Ω—ã –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (Grafana, HAProxy stats)
- [ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ WireGuard
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω firewall –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö
- [ ] SSH —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á–∞–º, root login –æ—Ç–∫–ª—é—á—ë–Ω
- [ ] –í–∫–ª—é—á–µ–Ω—ã —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] Prometheus/Grafana –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ VPN
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å NTOP –∑–∞—â–∏—â—ë–Ω –∏–ª–∏ –æ—Ç–∫–ª—é—á—ë–Ω
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Fail2ban –¥–ª—è –∑–∞—â–∏—Ç—ã SSH

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [`docs/SECURITY.md`](docs/SECURITY.md)

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞**: Backend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ DOWN –≤ HAProxy stats

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ WireGuard —Ç—É–Ω–Ω–µ–ª—å
sudo wg show

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤—è–∑–Ω–æ—Å—Ç—å
ping 10.0.0.5  # Oslo
ping 10.0.0.2  # Amsterdam

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–∏—Å –Ω–∞ backend
ssh user@10.0.0.5 "systemctl status vless"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ HAProxy
sudo tail -f /var/log/haproxy.log
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –∏–ª–∏ –ø–æ—Ç–µ—Ä—è –ø–∞–∫–µ—Ç–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MTU —Ç—É–Ω–Ω–µ–ª—è
ip link show wg0

# –¢–µ—Å—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ –ø–∞–∫–µ—Ç–æ–≤
ping -M do -s 1400 10.0.0.5

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ congestion
tc -s qdisc show dev wg0
```

**–ü—Ä–æ–±–ª–µ–º–∞**: Prometheus –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ targets –≤ Prometheus
curl http://localhost:9090/api/v1/targets

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ exporter –Ω–∞–ø—Ä—è–º—É—é
curl http://10.0.0.5:8443/metrics

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall
sudo ufw status
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –õ–∏–ø–∫–∏–µ —Å–µ—Å—Å–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–∏—Å–∏ –≤ stick-table
echo "show table vless_pool" | socat stdio /run/haproxy/admin.sock

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ IP –∫–ª–∏–µ–Ω—Ç–∞
tcpdump -i any -nn port 443
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: —Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ [`docs/`](docs/)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é](docs/DEPLOYMENT.md) - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](docs/SECURITY.md) - –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [–î–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](docs/diagrams/) - –í–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã

### [cosmic-ops](https://github.com/alienuniversed/cosmic-ops) - Ansible Automation

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç **–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –î–ª—è **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç **cosmic-ops**.

**cosmic-ops** –≤–∫–ª—é—á–∞–µ—Ç:
- üöÄ **87 Ansible playbooks** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è
- üì¶ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º** —Å–µ—Ä–≤–µ—Ä–æ–≤ (–æ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)
- ü§ñ **Telegram bot** –¥–ª—è ChatOps —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- üìä **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞
- üîß **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Ansible
- üìù **–°–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–µ–π–±—É–∫–∏** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å**:
```
1. cosmic-ops (Ansible) ‚Üí –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤
2. cosmic-ops (Ansible) ‚Üí –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–∑ —ç—Ç–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
3. cosmic-ops (Telegram Bot) ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```

**–ü–æ—á–µ–º—É –¥–≤–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è?**
- ‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –∫–æ–Ω—Ñ–∏–≥–∏ –æ—Ç–¥–µ–ª—å–Ω–æ, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –∫–æ–Ω—Ñ–∏–≥–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: —Å–µ–Ω—Å–∏—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- ‚úÖ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

> üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤–º–µ—Å—Ç–µ –¥–ª—è –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã!

**–ü–æ—Å—Ç—Ä–æ–µ–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –≤—ã—Å–æ–∫–æ–¥–æ—Å—Ç—É–ø–Ω–æ–π –ø—Ä–æ–∫—Å–∏-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**

